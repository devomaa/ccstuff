
local mainTerm = _G.term.current()

local mainW, mainH = mainTerm.getSize()
local shellTerm = window.create(mainTerm, 1, 1, mainW, mainH - 1)
_G.term.redirect(shellTerm)

local lineTerm = window.create(mainTerm, 1, mainH, mainW, 1)

local statusline = {}
_G.statusline = statusline

local i = 1
function statusline.redraw()
  lineTerm.clear()
  lineTerm.setCursorPos(1,1)
  lineTerm.write(i)
  i = i + 1
  mainTerm.restoreCursor()
end

local oldHandler = _G.mainProgram

function _G.mainProgram()
    parallel.waitForAny(oldHandler, function()
      while true do
        statusline.redraw()
        os.sleep(1)
      end
    end)
end
